<!DOCTYPE html>
<html>
<head>
    <title>Join Group - GroupEvent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        // Extract invite code first
        const path = window.location.pathname;
        console.log('Join page path:', path);
        
        const codeMatch = path.match(/join\/([^\/]+)/);
        const code = codeMatch ? codeMatch[1] : null;
        const redirectUrl = code ? `/?invite=${code}` : '/';
        
        // Check if we're in Snapchat and try to redirect to Safari
        const userAgent = navigator.userAgent.toLowerCase();
        const isSnapchat = userAgent.includes('snapchat');
        
        if (isSnapchat && /iPad|iPhone|iPod/.test(navigator.userAgent)) {
            console.log('Snapchat detected, trying Safari redirect');
            // Try to open in Safari using the working method
            window.location.href = 'x-web-search://?url=' + encodeURIComponent(window.location.origin + redirectUrl);
            
            // Fallback instructions if redirect doesn't work
            setTimeout(() => {
                document.body.innerHTML = `
                    <div style="padding: 20px; font-family: Arial, sans-serif; text-align: center;">
                        <h2>Open in Safari</h2>
                        <p>For the best experience, please open this link in Safari:</p>
                        <ol style="text-align: left; max-width: 300px; margin: 20px auto;">
                            <li>Tap the "..." or share button</li>
                            <li>Select "Open in Safari"</li>
                        </ol>
                        <p style="margin-top: 30px;">
                            <a href="${redirectUrl}" style="color: #2563eb; text-decoration: none; font-weight: bold;">
                                Continue in Snapchat â†’
                            </a>
                        </p>
                    </div>
                `;
            }, 1000);
        } else {
            // Not Snapchat or not iOS - use reliable meta refresh
            console.log('Using meta refresh redirect to:', redirectUrl);
            document.write(`<meta http-equiv="refresh" content="0; url=${redirectUrl}" />`);
        }
    </script>
</head>
<body>
    <p>Processing invite...</p>
    <p id="debug"></p>
    <script>
        document.getElementById('debug').textContent = 'Processing: ' + window.location.pathname;
    </script>
</body>
</html>