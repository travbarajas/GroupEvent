<!DOCTYPE html>
<html>
<head>
    <title>Join Group - GroupEvent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Force external browser for social media apps -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script>
        // Debug: log user agent
        console.log('User Agent:', navigator.userAgent);
        
        // Check if we're in Snapchat browser and try to redirect to Safari
        const userAgent = navigator.userAgent.toLowerCase();
        const isSnapchat = userAgent.includes('snapchat');
        
        console.log('Is Snapchat:', isSnapchat);
        
        if (isSnapchat) {
            // Try to force open in Safari
            const currentUrl = window.location.href;
            console.log('Snapchat detected, trying to open in Safari:', currentUrl);
            
            // Try different iOS Safari opening methods
            window.location.href = 'safari-' + currentUrl;
            
            // Show instructions after a brief delay if redirect doesn't work
            setTimeout(() => {
                document.body.innerHTML = `
                    <div style="padding: 20px; font-family: Arial, sans-serif; text-align: center;">
                        <h2>üîó Open in Safari</h2>
                        <p>Please open this link in Safari for the best experience:</p>
                        <ol style="text-align: left; max-width: 300px; margin: 20px auto;">
                            <li>Tap the share button (‚ÜóÔ∏è)</li>
                            <li>Select "Open in Safari"</li>
                        </ol>
                        <p style="margin-top: 30px;">
                            <a href="${currentUrl}" style="color: #2563eb; text-decoration: none; font-weight: bold; background: #f0f0f0; padding: 8px 16px; border-radius: 4px;">
                                Continue Here Anyway ‚Üí
                            </a>
                        </p>
                    </div>
                `;
            }, 500);
        } else {
            // Not Snapchat - proceed with normal invite processing
            console.log('Not Snapchat, proceeding normally');
            
            // Extract invite code from URL and redirect to main app
            const path = window.location.pathname;
            console.log('Join page path:', path);
            
            const codeMatch = path.match(/join\/([^\/]+)/);
            const code = codeMatch ? codeMatch[1] : null;
            
            console.log('Extracted invite code:', code);
            
            if (code) {
                // Redirect to main app with invite code as query parameter
                const redirectUrl = `/?invite=${code}`;
                console.log('Redirecting to:', redirectUrl);
                window.location.href = redirectUrl;
            } else {
                // No code found, redirect to home
                console.log('No code found, redirecting to home');
                window.location.href = '/';
            }
        }
    </script>
</head>
<body>
    <p>Processing invite...</p>
    <p id="debug"></p>
    <script>
        document.getElementById('debug').textContent = 'Path: ' + window.location.pathname;
    </script>
</body>
</html>