<!DOCTYPE html>
<html>
<head>
    <title>Join Group - GroupEvent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        // Extract invite code first
        const path = window.location.pathname;
        console.log('Join page path:', path);
        
        const codeMatch = path.match(/join\/([^\/]+)/);
        const code = codeMatch ? codeMatch[1] : null;
        const redirectUrl = code ? `/?invite=${code}` : '/';
        
        // Check if we're in Snapchat and try to redirect to Safari
        const userAgent = navigator.userAgent.toLowerCase();
        const isSnapchat = userAgent.includes('snapchat');
        
        if (isSnapchat && /iPad|iPhone|iPod/.test(navigator.userAgent)) {
            console.log('Snapchat detected, forcing Safari redirect');
            
            const fullInviteUrl = window.location.origin + redirectUrl;
            
            // Attempt to open in Safari using window.open (most reliable method)
            const newWindow = window.open(fullInviteUrl, '_blank');
            
            // Fallback: Redirect in same tab if popup is blocked
            setTimeout(() => {
                if (!newWindow || newWindow.closed) {
                    console.log('Popup blocked, redirecting in same tab');
                    window.location.href = fullInviteUrl;
                } else {
                    console.log('Successfully opened in new tab/Safari');
                }
            }, 500);
            
            // Show message while redirect happens
            document.body.innerHTML = `
                <div style="padding: 20px; font-family: Arial, sans-serif; text-align: center;">
                    <h2>ðŸš€ Opening in Safari...</h2>
                    <p>Redirecting to the best experience!</p>
                    <p style="margin-top: 20px; font-size: 14px; color: #666;">
                        If nothing happens, <a href="${fullInviteUrl}" style="color: #2563eb;">tap here</a>
                    </p>
                </div>
            `;
        } else {
            // Not Snapchat or not iOS - use reliable meta refresh
            console.log('Using meta refresh redirect to:', redirectUrl);
            document.write(`<meta http-equiv="refresh" content="0; url=${redirectUrl}" />`);
        }
    </script>
</head>
<body>
    <p>Processing invite...</p>
    <p id="debug"></p>
    <script>
        document.getElementById('debug').textContent = 'Processing: ' + window.location.pathname;
    </script>
</body>
</html>