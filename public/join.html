<!DOCTYPE html>
<html>
<head>
    <title>Join Group - GroupEvent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Force external browser for social media apps -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script>
        // Detect if we're in an in-app browser and try to open externally
        function tryOpenExternally() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isInApp = userAgent.includes('snapchat') || 
                           userAgent.includes('fban') || 
                           userAgent.includes('fbav') || 
                           userAgent.includes('instagram') || 
                           userAgent.includes('twitter') ||
                           userAgent.includes('tiktok');
            
            if (isInApp) {
                // Try to open in external browser
                const currentUrl = window.location.href;
                
                // For iOS devices, try to use universal link patterns
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    // Try Safari - fix the URL scheme
                    window.location.href = currentUrl.replace('https://', 'safari-https://');
                    
                    // Fallback - show instructions
                    setTimeout(() => {
                        document.body.innerHTML = `
                            <div style="padding: 20px; font-family: Arial, sans-serif; text-align: center;">
                                <h2>Open in Browser</h2>
                                <p>For the best experience, please open this link in your browser:</p>
                                <ol style="text-align: left; max-width: 300px; margin: 20px auto;">
                                    <li>Tap the "..." or share button</li>
                                    <li>Select "Open in Safari" or "Open in Browser"</li>
                                </ol>
                                <p style="margin-top: 30px;">
                                    <a href="${currentUrl}" style="color: #2563eb; text-decoration: none; font-weight: bold;">
                                        Continue Anyway â†’
                                    </a>
                                </p>
                            </div>
                        `;
                    }, 1000);
                    return true;
                }
            }
            return false;
        }
    </script>
    <script>
        // Normal flow function
        function normalFlow() {
            // Extract invite code from URL and redirect to main app
            const path = window.location.pathname;
            console.log('Join page path:', path);
            
            const codeMatch = path.match(/join\/([^\/]+)/);
            const code = codeMatch ? codeMatch[1] : null;
            
            console.log('Extracted invite code:', code);
            
            if (code) {
                // Redirect to main app with invite code as query parameter
                const redirectUrl = `/?invite=${code}`;
                console.log('Redirecting to:', redirectUrl);
                window.location.href = redirectUrl;
            } else {
                // No code found, redirect to home
                console.log('No code found, redirecting to home');
                window.location.href = '/';
            }
        }

        // First try to open externally if in in-app browser
        if (!tryOpenExternally()) {
            normalFlow();
        }
    </script>
</head>
<body>
    <p>Processing invite...</p>
    <p id="debug"></p>
    <script>
        document.getElementById('debug').textContent = 'Path: ' + window.location.pathname;
    </script>
</body>
</html>