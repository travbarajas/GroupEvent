<!DOCTYPE html>
<html>
<head>
    <title>Join Group - GroupEvent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Force external browser for social media apps -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script>
        // Detect if we're in an in-app browser and try to open externally
        function tryOpenExternally() {
            const userAgent = navigator.userAgent.toLowerCase();
            const isInApp = userAgent.includes('snapchat') || 
                           userAgent.includes('fban') || 
                           userAgent.includes('fbav') || 
                           userAgent.includes('instagram') || 
                           userAgent.includes('twitter') ||
                           userAgent.includes('tiktok');
            
            if (isInApp) {
                // Show instructions to open in external browser
                const currentUrl = window.location.href;
                
                document.body.innerHTML = `
                    <div style="padding: 20px; font-family: Arial, sans-serif; text-align: center; background: #0a0a0a; color: #ffffff; min-height: 100vh;">
                        <h2 style="color: #60a5fa; margin-bottom: 20px;">ðŸ“± Open in Browser</h2>
                        <p style="margin-bottom: 20px;">For the best experience, please open this link in your browser:</p>
                        
                        <div style="background: #1a1a1a; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 320px;">
                            <ol style="text-align: left; padding-left: 20px; line-height: 1.6;">
                                <li>Tap the <strong>"..."</strong> or share button</li>
                                <li>Select <strong>"Open in Safari"</strong> or <strong>"Open in Browser"</strong></li>
                            </ol>
                        </div>
                        
                        <p style="font-size: 14px; color: #9ca3af; margin: 20px 0;">
                            This ensures you stay logged in as the same person
                        </p>
                        
                        <p style="margin-top: 30px;">
                            <a href="${currentUrl}" 
                               style="color: #60a5fa; text-decoration: none; font-weight: bold; background: #1a1a1a; padding: 12px 24px; border-radius: 8px; display: inline-block;"
                               onclick="proceedAnyway()">
                                Continue Anyway â†’
                            </a>
                        </p>
                    </div>
                `;
                
                // Add proceed anyway function
                window.proceedAnyway = function() {
                    // Clear the instructions and proceed with normal flow
                    document.body.innerHTML = '<p style="color: white; text-align: center; padding: 20px;">Processing invite...</p>';
                    setTimeout(() => {
                        normalFlow();
                    }, 500);
                };
                
                return true;
            }
            return false;
        }
    </script>
    <script>
        // Normal flow function
        function normalFlow() {
            // Extract invite code from URL and redirect to main app
            const path = window.location.pathname;
            console.log('Join page path:', path);
            
            const codeMatch = path.match(/join\/([^\/]+)/);
            const code = codeMatch ? codeMatch[1] : null;
            
            console.log('Extracted invite code:', code);
            
            if (code) {
                // Redirect to main app with invite code as query parameter
                const redirectUrl = `/?invite=${code}`;
                console.log('Redirecting to:', redirectUrl);
                window.location.href = redirectUrl;
            } else {
                // No code found, redirect to home
                console.log('No code found, redirecting to home');
                window.location.href = '/';
            }
        }

        // First try to open externally if in in-app browser
        if (!tryOpenExternally()) {
            normalFlow();
        }
    </script>
</head>
<body>
    <p>Processing invite...</p>
    <p id="debug"></p>
    <script>
        document.getElementById('debug').textContent = 'Path: ' + window.location.pathname;
    </script>
</body>
</html>